name: 'Go Actions Cache'
description: 'A GitHub Action to use a custom GOCACHEPROG'
runs:
  using: composite
  steps:
    - uses: actions/checkout@v2
    - shell: bash
      name: 'Build Go Actions Cache Binary'
      run: |
        docker build --output=_bin .
    - shell: bash
      name: 'Set Go Actions Cache Environment Variables'
      run: |
        echo "PATH=$(pwd)/_bin:$PATH" >> $GITHUB_ENV
        echo "GOCACHEPROG=actions-cache-go" >> $GITHUB_ENV
        if [ -z "${GOEXPERIMENT}" ]; then
          echo "GOEXPERIMENT=cacheprog" >> $GITHUB_ENV
        else
          echo "GOEXPERIMENT=cacheprog,${GOEXPERIMENT}" >> $GITHUB_ENV
        fi
        echo "GOEXPERIMENT=cacheprog,${GOEXPERIMENT}" >> $GITHUB_ENV
    - uses: crazy-max/ghaction-github-runtime@v3
      name: Expose github actions info for go-actions-cache